<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#030213">
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#030213" media="(prefers-color-scheme: dark)">
  
  <!-- PWA Meta Tags -->
  <meta name="application-name" content="BudgetTracker">
  <meta name="description" content="Мобильное приложение для отслеживания и планирования бюджета с возможностью загрузки скриншотов банковских операций">
  <meta name="keywords" content="бюджет, финансы, планирование, мобильное приложение, OCR, банковские операции">
  <meta name="author" content="BudgetTracker">
  
  <!-- Mobile Optimization -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="BudgetTracker">
  <meta name="format-detection" content="telephone=no">
  
  <!-- Windows/Edge -->
  <meta name="msapplication-TileColor" content="#030213">
  <meta name="msapplication-tap-highlight" content="no">
  
  <!-- Manifest -->
  <link rel="manifest" href="/manifest.json">
  
  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png">
  <link rel="apple-touch-icon" href="/icons/icon-180x180.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-167x167.png">
  
  <!-- Splash screens for iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-startup-image" href="/splash/splash-2048x2732.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="/splash/splash-1668x2388.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="/splash/splash-1536x2048.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="/splash/splash-1290x2796.png" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="/splash/splash-1179x2556.png" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="/splash/splash-1170x2532.png" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  
  <title>BudgetTracker - Умное планирование финансов</title>
  
  <!-- Security -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:; connect-src 'self' https:;">
  
  <style>
    /* Critical CSS for loading */
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background-color: #ffffff;
      color: #030213;
    }
    
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .loading-icon {
      width: 64px;
      height: 64px;
      background: #030213;
      border-radius: 12px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .loading-text {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .loading-subtitle {
      font-size: 14px;
      color: #717182;
    }
    
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #030213;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      margin-top: 16px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      body {
        background-color: #0a0a0b;
        color: #ffffff;
      }
      
      .loading-screen {
        background: #0a0a0b;
      }
      
      .loading-icon {
        background: #ffffff;
      }
      
      .loading-subtitle {
        color: #9ca3af;
      }
    }
  </style>
</head>
<body>
  <div id="loading-screen" class="loading-screen">
    <div class="loading-icon">
      <!-- Wallet icon in white -->
      <svg width="32" height="32" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
        <path d="M19 7H16V6C16 3.79 14.21 2 12 2S8 3.79 8 6V7H5C3.9 7 3 7.9 3 9V20C3 21.1 3.9 22 5 22H19C20.1 22 21 21.1 21 20V9C21 7.9 20.1 7 19 7ZM10 6C10 4.9 10.9 4 12 4S14 4.9 14 6V7H10V6ZM19 20H5V9H19V20ZM12 12C10.9 12 10 12.9 10 14S10.9 16 12 16S14 15.1 14 14S13.1 12 12 12Z"/>
      </svg>
    </div>
    <div class="loading-text">BudgetTracker</div>
    <div class="loading-subtitle">Умное планирование финансов</div>
    <div class="spinner"></div>
  </div>
  
  <div id="root"></div>
  
  <!-- Service Worker Registration -->
  <script>
    // Hide loading screen when app loads
    window.addEventListener('load', function() {
      setTimeout(function() {
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
          loadingScreen.style.opacity = '0';
          loadingScreen.style.transition = 'opacity 0.3s ease-out';
          setTimeout(function() {
            loadingScreen.style.display = 'none';
          }, 300);
        }
      }, 1000);
    });
    
    // Register service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js')
          .then(function(registration) {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
            
            // Check for updates
            registration.addEventListener('updatefound', function() {
              const newWorker = registration.installing;
              newWorker.addEventListener('statechange', function() {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // New update available
                  console.log('New content is available; please refresh.');
                  if (window.confirm('Доступна новая версия приложения. Обновить?')) {
                    window.location.reload();
                  }
                }
              });
            });
          })
          .catch(function(err) {
            console.log('ServiceWorker registration failed: ', err);
          });
      });
    }
    
    // Install prompt
    let deferredPrompt;
    
    window.addEventListener('beforeinstallprompt', function(e) {
      console.log('beforeinstallprompt fired');
      e.preventDefault();
      deferredPrompt = e;
      
      // Show custom install button/banner
      showInstallPromotion();
    });
    
    function showInstallPromotion() {
      // You can show a custom install banner here
      console.log('App can be installed');
    }
    
    // Handle install click
    function installApp() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(function(choiceResult) {
          if (choiceResult.outcome === 'accepted') {
            console.log('User accepted the install prompt');
          } else {
            console.log('User dismissed the install prompt');
          }
          deferredPrompt = null;
        });
      }
    }
    
    // Expose install function globally
    window.installApp = installApp;
  </script>
</body>
</html>